#!/bin/bash

################################################################################
# Protei Monitoring - Version Script
# Displays version information and build details
################################################################################

# Application paths
APP_HOME="/usr/protei/Protei_Monitoring"
VERSION_FILE="$APP_HOME/VERSION"
CONFIG_DIR="$APP_HOME/config"

# Colors
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
NC='\033[0m'

print_header() {
    echo -e "\n${GREEN}╔════════════════════════════════════════════════════════╗${NC}"
    echo -e "${GREEN}║          PROTEI MONITORING - VERSION INFO             ║${NC}"
    echo -e "${GREEN}╚════════════════════════════════════════════════════════╝${NC}\n"
}

# Show version information
show_version() {
    echo -e "${BLUE}Version Information:${NC}"
    echo -e "${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"

    if [ -f "$VERSION_FILE" ]; then
        while IFS=: read -r key value; do
            printf "  %-20s %s\n" "$key" "$value"
        done < "$VERSION_FILE"
    else
        echo -e "  ${YELLOW}Version file not found${NC}"
        echo -e "  Location: $VERSION_FILE"
    fi

    echo ""
}

# Show protocol support
show_protocols() {
    echo -e "${BLUE}Protocol Support:${NC}"
    echo -e "${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"

    PROTOCOLS_FILE="$CONFIG_DIR/protocols.cfg"

    if [ -f "$PROTOCOLS_FILE" ]; then
        source "$PROTOCOLS_FILE"

        echo "  Generations:"
        [ "${GENERATION_2G:-false}" = "true" ] && echo "    - 2G (GSM/GPRS)" || true
        [ "${GENERATION_3G:-false}" = "true" ] && echo "    - 3G (UMTS/HSPA)" || true
        [ "${GENERATION_4G:-false}" = "true" ] && echo "    - 4G (LTE)" || true
        [ "${GENERATION_5G:-false}" = "true" ] && echo "    - 5G (NR)" || true

        echo ""
        echo "  Protocols:"
        [ "$MAP_ENABLED" = "true" ] && echo "    - MAP (Mobile Application Part)" || true
        [ "$CAP_ENABLED" = "true" ] && echo "    - CAP (CAMEL Application Part)" || true
        [ "$INAP_ENABLED" = "true" ] && echo "    - INAP (Intelligent Network Application Part)" || true
        [ "$DIAMETER_ENABLED" = "true" ] && echo "    - Diameter (S6a, Gx, Gy, Gz)" || true
        [ "$GTP_ENABLED" = "true" ] && echo "    - GTP-C v1/v2 (Bearer Management)" || true
        [ "$PFCP_ENABLED" = "true" ] && echo "    - PFCP (Packet Forwarding Control)" || true
        [ "$HTTP_ENABLED" = "true" ] && echo "    - HTTP/2 (5G Service-Based Architecture)" || true
        [ "$NGAP_ENABLED" = "true" ] && echo "    - NGAP (5G N2 Interface)" || true
        [ "$S1AP_ENABLED" = "true" ] && echo "    - S1AP (4G S1 Interface)" || true
        [ "$NAS_ENABLED" = "true" ] && echo "    - NAS (Non-Access Stratum)" || true
    else
        echo -e "  ${YELLOW}Protocol configuration not found${NC}"
    fi

    echo ""
}

# Show features
show_features() {
    echo -e "${BLUE}Features:${NC}"
    echo -e "${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"

    echo "  Core Capabilities:"
    echo "    ✓ Multi-protocol decoding (10+ protocols)"
    echo "    ✓ AI-based analysis and issue detection"
    echo "    ✓ 3GPP protocol knowledge base"
    echo "    ✓ Message flow reconstruction"
    echo "    ✓ Subscriber correlation"
    echo "    ✓ Real-time monitoring"
    echo ""
    echo "  Analysis Features:"
    echo "    ✓ Automatic issue detection"
    echo "    ✓ Root cause analysis"
    echo "    ✓ Flow deviation detection"
    echo "    ✓ Performance KPI tracking"
    echo "    ✓ 3GPP standards compliance"
    echo ""
    echo "  Enterprise Features:"
    echo "    ✓ JWT authentication & RBAC"
    echo "    ✓ License management"
    echo "    ✓ Web-based configuration"
    echo "    ✓ RESTful API"
    echo "    ✓ Real-time WebSocket updates"
    echo "    ✓ Source code encryption"
    echo ""
}

# Show license information
show_license_info() {
    echo -e "${BLUE}License Information:${NC}"
    echo -e "${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"

    LICENSE_FILE="$CONFIG_DIR/license.cfg"

    if [ -f "$LICENSE_FILE" ]; then
        source "$LICENSE_FILE"

        echo "  Customer: ${LICENSE_CUSTOMER:-Not specified}"
        echo "  Expiry Date: ${LICENSE_EXPIRY:-Not specified}"
        echo "  MAC Address: ${LICENSE_MAC:-Not bound}"

        if [ -n "$LICENSE_MAX_SUBSCRIBERS" ]; then
            echo "  Max Subscribers: ${LICENSE_MAX_SUBSCRIBERS}"
        fi

        if [ -n "$LICENSE_MAX_TPS" ]; then
            echo "  Max TPS: ${LICENSE_MAX_TPS}"
        fi
    else
        echo -e "  ${YELLOW}License file not found${NC}"
    fi

    echo ""
}

# Show system information
show_system_info() {
    echo -e "${BLUE}System Information:${NC}"
    echo -e "${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"

    echo "  Hostname: $(hostname)"
    echo "  OS: $(cat /etc/os-release | grep PRETTY_NAME | cut -d'"' -f2)"
    echo "  Kernel: $(uname -r)"
    echo "  Architecture: $(uname -m)"

    # Check if Go is available
    if command -v go &> /dev/null; then
        echo "  Go Version: $(go version | awk '{print $3}')"
    fi

    # Show installation directory
    echo "  Install Path: $APP_HOME"

    echo ""
}

# Show support information
show_support() {
    echo -e "${BLUE}Support & Contact:${NC}"
    echo -e "${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"

    echo "  Technical Support: support@protei-monitoring.com"
    echo "  Sales & Licensing: sales@protei-monitoring.com"
    echo "  Documentation: https://docs.protei-monitoring.com"
    echo ""
}

# Show copyright
show_copyright() {
    echo -e "${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
    echo "  Copyright © 2025 Protei Monitoring. All rights reserved."
    echo "  Proprietary and confidential software."
    echo -e "${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
    echo ""
}

# Main execution
main() {
    print_header
    show_version
    show_protocols
    show_features
    show_license_info
    show_system_info
    show_support
    show_copyright
}

# Run main
main "$@"
