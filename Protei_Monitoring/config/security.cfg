# Protei Monitoring - Security Configuration
# LDAP, password policies, and security settings

# =============================================================================
# LDAP/Active Directory Integration
# =============================================================================

# LDAP Enable/Disable
LDAP_ENABLED=false

# LDAP Server Settings
LDAP_HOST="ldap.example.com"
LDAP_PORT=389
LDAP_USE_TLS=false
LDAP_USE_SSL=false  # LDAPS on port 636
LDAP_SKIP_TLS_VERIFY=false  # Only for testing!

# LDAP Bind Settings
LDAP_BIND_DN="cn=admin,dc=example,dc=com"
LDAP_BIND_PASSWORD="CHANGE_ME"

# LDAP Search Settings
LDAP_BASE_DN="dc=example,dc=com"
LDAP_USER_FILTER="(uid=%s)"  # %s will be replaced with username
LDAP_USER_BASE_DN="ou=users,dc=example,dc=com"
LDAP_GROUP_BASE_DN="ou=groups,dc=example,dc=com"

# LDAP Attribute Mapping
LDAP_ATTR_USERNAME="uid"
LDAP_ATTR_EMAIL="mail"
LDAP_ATTR_FULL_NAME="cn"
LDAP_ATTR_PHONE="telephoneNumber"
LDAP_ATTR_DEPARTMENT="department"

# LDAP Group Mapping (LDAP group -> Application role)
LDAP_GROUP_ADMIN="cn=ProteiAdmins,ou=groups,dc=example,dc=com"
LDAP_GROUP_ENGINEER="cn=ProteiEngineers,ou=groups,dc=example,dc=com"
LDAP_GROUP_NOC="cn=ProteiNOC,ou=groups,dc=example,dc=com"
LDAP_GROUP_AUDITOR="cn=ProteiAuditors,ou=groups,dc=example,dc=com"

# LDAP Nested Groups
LDAP_NESTED_GROUPS=true

# LDAP Connection Pool
LDAP_POOL_SIZE=10
LDAP_POOL_MAX_IDLE=5
LDAP_POOL_MAX_LIFETIME=3600  # seconds

# LDAP Sync Settings
LDAP_AUTO_SYNC_USERS=false
LDAP_SYNC_INTERVAL=86400  # seconds (24 hours)
LDAP_AUTO_CREATE_USERS=true  # Auto-create user on first LDAP login

# Active Directory Specific
AD_DOMAIN="example.com"
AD_USE_KERBEROS=false

# =============================================================================
# Password Policy (Local Users)
# =============================================================================

# Complexity Requirements
PASSWORD_MIN_LENGTH=12
PASSWORD_MAX_LENGTH=128
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SPECIAL=true
PASSWORD_SPECIAL_CHARS="!@#$%^&*()-_=+[]{}|;:,.<>?"

# Password History
PASSWORD_HISTORY_COUNT=5  # Remember last N passwords
PASSWORD_MIN_AGE_DAYS=1  # Minimum days before change allowed
PASSWORD_MAX_AGE_DAYS=90  # Maximum days before change required
PASSWORD_EXPIRE_WARNING_DAYS=14

# Password Validation
PASSWORD_DISALLOW_USERNAME=true
PASSWORD_DISALLOW_COMMON=true  # Disallow common passwords
PASSWORD_COMMON_PASSWORDS_FILE="/usr/protei/Protei_Monitoring/config/common_passwords.txt"

# =============================================================================
# Account Lockout Policy
# =============================================================================

# Failed Login Protection
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION=1800  # seconds (30 minutes)
LOCKOUT_RESET_TIME=3600  # seconds (1 hour)
LOCKOUT_NOTIFY_ADMIN=true

# Account Deactivation
AUTO_DEACTIVATE_INACTIVE_DAYS=90
AUTO_DELETE_INACTIVE_DAYS=365

# =============================================================================
# Session Security
# =============================================================================

# Session Management
SESSION_TIMEOUT=3600  # seconds (1 hour)
SESSION_ABSOLUTE_TIMEOUT=43200  # seconds (12 hours)
SESSION_MAX_CONCURRENT=5  # Max concurrent sessions per user
SESSION_BIND_IP=true  # Bind session to IP address
SESSION_BIND_USER_AGENT=false

# Session Cookie Settings
SESSION_COOKIE_NAME="protei_session"
SESSION_COOKIE_SECURE=true  # Require HTTPS
SESSION_COOKIE_HTTP_ONLY=true
SESSION_COOKIE_SAME_SITE="Strict"  # Strict, Lax, None

# Remember Me
REMEMBER_ME_ENABLED=false
REMEMBER_ME_DURATION=604800  # seconds (7 days)

# =============================================================================
# JWT Security
# =============================================================================

# JWT Settings
JWT_ALGORITHM="HS256"  # HS256, HS384, HS512, RS256
JWT_SECRET="CHANGE_ME_RANDOM_SECRET_MIN_32_CHARS"
JWT_ISSUER="protei-monitoring"
JWT_AUDIENCE="protei-monitoring-api"

# JWT Expiration
JWT_ACCESS_TOKEN_EXPIRY=3600  # seconds (1 hour)
JWT_REFRESH_TOKEN_EXPIRY=604800  # seconds (7 days)

# JWT Validation
JWT_VALIDATE_ISSUER=true
JWT_VALIDATE_AUDIENCE=true
JWT_VALIDATE_EXPIRY=true

# JWT Claims
JWT_INCLUDE_USER_ID=true
JWT_INCLUDE_USERNAME=true
JWT_INCLUDE_ROLES=true
JWT_INCLUDE_IP=true

# =============================================================================
# API Security
# =============================================================================

# API Key Authentication
API_KEY_ENABLED=false
API_KEY_HEADER="X-API-Key"
API_KEY_LENGTH=32

# CORS (Cross-Origin Resource Sharing)
CORS_ENABLED=true
CORS_ALLOWED_ORIGINS="*"  # Comma-separated or * for all
CORS_ALLOWED_METHODS="GET,POST,PUT,DELETE,OPTIONS"
CORS_ALLOWED_HEADERS="Content-Type,Authorization,X-API-Key"
CORS_ALLOW_CREDENTIALS=true
CORS_MAX_AGE=86400  # seconds

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=100  # requests per window
RATE_LIMIT_WINDOW=60  # seconds
RATE_LIMIT_BY_IP=true
RATE_LIMIT_BY_USER=true

# IP Whitelisting
IP_WHITELIST_ENABLED=false
IP_WHITELIST=""  # Comma-separated IPs or CIDR ranges

# IP Blacklisting
IP_BLACKLIST_ENABLED=false
IP_BLACKLIST=""  # Comma-separated IPs or CIDR ranges

# =============================================================================
# TLS/SSL Settings
# =============================================================================

# TLS Configuration
TLS_ENABLED=true
TLS_MIN_VERSION="1.2"  # 1.0, 1.1, 1.2, 1.3
TLS_CIPHER_SUITES="TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
TLS_PREFER_SERVER_CIPHER_SUITES=true

# Client Certificate Authentication
TLS_CLIENT_AUTH=false  # Require client certificates
TLS_CLIENT_CA="/usr/protei/Protei_Monitoring/config/certs/client-ca.crt"

# =============================================================================
# Audit & Compliance
# =============================================================================

# Audit Logging
AUDIT_ENABLED=true
AUDIT_LOG_FILE="/usr/protei/Protei_Monitoring/logs/audit/audit.log"
AUDIT_LOG_FORMAT="JSON"  # JSON or CSV

# Audit Events
AUDIT_LOGIN=true
AUDIT_LOGOUT=true
AUDIT_LOGIN_FAILED=true
AUDIT_PASSWORD_CHANGE=true
AUDIT_CONFIG_CHANGE=true
AUDIT_USER_MANAGEMENT=true
AUDIT_API_CALLS=false  # Can be very verbose
AUDIT_DATA_ACCESS=true

# Audit Retention
AUDIT_RETENTION_DAYS=365  # 1 year minimum for compliance
AUDIT_AUTO_DELETE_OLD=false  # Careful! May violate compliance

# Compliance
COMPLIANCE_MODE=false  # Enable stricter security settings
COMPLIANCE_STANDARD="NONE"  # PCI-DSS, HIPAA, GDPR, SOC2

# =============================================================================
# Encryption
# =============================================================================

# Data Encryption at Rest
ENCRYPT_DATABASE=false
ENCRYPT_CDR_FILES=false
ENCRYPT_LOG_FILES=false

# Encryption Algorithm
ENCRYPTION_ALGORITHM="AES-256-GCM"
ENCRYPTION_KEY_FILE="/usr/protei/Protei_Monitoring/config/encryption.key"

# =============================================================================
# Source Code Protection
# =============================================================================

# Source Code Encryption
SOURCE_CODE_ENCRYPTED=true
SOURCE_CODE_DECRYPT_ON_MEMORY=true  # Decrypt only in memory
SOURCE_CODE_ALLOW_DUMP=false  # Prevent memory dumps

# Binary Protection
BINARY_OBFUSCATION=true
BINARY_ANTI_DEBUG=false
BINARY_ANTI_TAMPER=false

# =============================================================================
# Security Headers
# =============================================================================

# HTTP Security Headers
SECURITY_HEADERS_ENABLED=true
HEADER_X_FRAME_OPTIONS="DENY"
HEADER_X_CONTENT_TYPE_OPTIONS="nosniff"
HEADER_X_XSS_PROTECTION="1; mode=block"
HEADER_STRICT_TRANSPORT_SECURITY="max-age=31536000; includeSubDomains"
HEADER_CONTENT_SECURITY_POLICY="default-src 'self'"
HEADER_REFERRER_POLICY="no-referrer"

# =============================================================================
# Intrusion Detection
# =============================================================================

# Anomaly Detection
DETECT_BRUTE_FORCE=true
DETECT_SQL_INJECTION=true
DETECT_XSS_ATTEMPTS=true
DETECT_DIRECTORY_TRAVERSAL=true
DETECT_UNUSUAL_API_PATTERNS=true

# Response Actions
AUTO_BLOCK_SUSPICIOUS_IP=true
AUTO_BLOCK_DURATION=3600  # seconds
ALERT_ADMIN_ON_INTRUSION=true
ALERT_EMAIL="security@example.com"

# =============================================================================
# Backup Security
# =============================================================================

# Backup Encryption
BACKUP_ENCRYPTION_ENABLED=true
BACKUP_ENCRYPTION_ALGORITHM="AES-256-CBC"

# Backup Access Control
BACKUP_ACCESS_RESTRICTED=true
BACKUP_ACCESS_ROLES="admin"  # Only admins can access backups
